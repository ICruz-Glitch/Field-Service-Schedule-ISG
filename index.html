<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Service Scheduler</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css' rel='stylesheet' />
  <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js'></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; }
    header { padding: 10px; background: #333; color: #fff; text-align: center; }
    #controls { display: flex; justify-content: space-between; padding: 10px; }
    #techList span { margin-right: 10px; padding: 4px 6px; border-radius: 4px; color: #fff; cursor: pointer; }
    #calendar { margin: 10px; }
    #monthTabs button { margin: 5px; padding: 5px 10px; }
  </style>
</head>
<body>
  <header>
    <h2>Field Service Scheduler - Monthly View</h2>
  </header>
  <div id="controls">
    <div>
      <button onclick="openTechModal()">Technician Settings</button>
    </div>
    <div id="techList"></div>
  </div>
  <div id="calendar"></div>

  <div id="techModal" style="display:none; position:fixed; top:20%; left:30%; background:white; border:1px solid #ccc; padding:10px; z-index:1000">
    <h3>Edit Technicians</h3>
    <div id="techInputs"></div>
    <input id="newTechName" placeholder="Technician name">
    <input id="newTechColor" type="color">
    <button onclick="addTech()">Add Technician</button>
    <br><br>
    <button onclick="saveTechs()">Save</button>
    <button onclick="closeTechModal()">Close</button>
  </div>

  <script>
    let selectedTech = null;
    let techs = JSON.parse(localStorage.getItem('techs')) || [];
    let schedule = JSON.parse(localStorage.getItem('schedule')) || [];

    function renderTechs() {
      const techList = document.getElementById("techList");
      techList.innerHTML = "";
      techs.forEach((t, i) => {
        const span = document.createElement("span");
        span.textContent = t.name;
        span.style.backgroundColor = t.color;
        span.onclick = () => selectedTech = t;
        techList.appendChild(span);
      });
    }

    function openTechModal() {
      document.getElementById("techModal").style.display = "block";
      renderTechInputs();
    }

    function closeTechModal() {
      document.getElementById("techModal").style.display = "none";
    }

    function renderTechInputs() {
      const container = document.getElementById("techInputs");
      container.innerHTML = "";
      techs.forEach((t, i) => {
        const div = document.createElement("div");
        div.innerHTML = `<input value="${t.name}" onchange="editTechName(${i}, this.value)"> 
                          <input type="color" value="${t.color}" onchange="editTechColor(${i}, this.value)"> 
                          <button onclick="removeTech(${i})">Remove</button>`;
        container.appendChild(div);
      });
    }

    function editTechName(index, newName) {
      techs[index].name = newName;
      renderTechs();
    }

    function editTechColor(index, newColor) {
      techs[index].color = newColor;
      renderTechs();
    }

    function addTech() {
      const name = document.getElementById("newTechName").value;
      const color = document.getElementById("newTechColor").value;
      if (name && color) {
        techs.push({ name, color });
        document.getElementById("newTechName").value = "";
        renderTechInputs();
      }
    }

    function removeTech(index) {
      techs.splice(index, 1);
      renderTechInputs();
      renderTechs();
    }

    function saveTechs() {
      localStorage.setItem("techs", JSON.stringify(techs));
      renderTechs();
      closeTechModal();
    }

    function saveSchedule() {
      localStorage.setItem("schedule", JSON.stringify(schedule));
    }

    document.addEventListener('DOMContentLoaded', function () {
      const calendarEl = document.getElementById('calendar');
      const calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        height: 'auto',
        selectable: true,
        select: function (info) {
          if (!selectedTech) {
            alert('Select a technician first');
            return;
          }
          const event = {
            title: `(${selectedTech.name})`,
            start: info.startStr,
            end: info.endStr,
            color: selectedTech.color
          };
          calendar.addEvent(event);
          schedule.push(event);
          saveSchedule();
        },
        events: schedule
      });
      calendar.render();
    });

    renderTechs();
  </script>
</body>
</html>